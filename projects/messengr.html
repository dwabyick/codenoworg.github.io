
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Messengr - CodeNow Curriculum</title>
  <meta name="author" content="CodeNowOrg">

  
  <meta name="description" content="Messengr In this project, students will learn how to build a chat room in the terminal. Learning Goals: Understand the basics of HTTP requests (GET &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://CodeNowOrg.github.io/projects/messengr.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="CodeNow Curriculum" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">CodeNow Curriculum</a></h1>
  
    <h2>A guide to teaching a CodeNow class.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:CodeNowOrg.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  

<ul class="main-navigation">
  <li><a href="/">Curriculum Index</a></li>
</ul>
</nav>
  <div id="main">
    <div id="content">
      <div>
  <article role="article">
    
    <header>
      
      <h1 class="entry-title">Messengr</h1>
      
    </header>
    
    <p>In this project, students will learn how to build a chat room in the terminal.</p>

<p>Learning Goals:</p>

<ul>
<li>Understand the basics of HTTP requests (GET, POST)</li>
<li>Learn how to use Ruby to interact with the web</li>
<li>Reinforce fundamental programming concepts like while loops, conditional logic, and debugging</li>
</ul>


<h2>Iteration 0: Up &amp; running</h2>

<p>Install the <code>httparty</code> gem by running <code>gem install httparty</code> from the command prompt:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>$</span>
</pre></td><td class='code'><pre><code><span class='line command'>gem install httparty</span></code></pre></td></tr></table></div></div>
        </div>


<p>We will be using httparty to get and post messages to the custom CodeNow messaging service which is located at <a href="http://messengr.herokuapp.com">messengr.herokuapp.com</a>. If you&rsquo;d like to make changes to the repo, you can do so <a href="https://github.com/CodeNowOrg/messengr">here</a>.</p>

<div class="note">
<p>You will want to clear out all existing messages prior to starting this exercise. The control panel to do so lives <a href="http://messengr.herokuapp.com/messages">here</a>.</p>
</div>


<h2>Iteration 1: Receiving messages</h2>

<h3>Step 0: Learning about GET requests</h3>

<p>We&rsquo;re going to have to teach the concept of a GET request to students. Using a browser, have the students visit <a href="http://messengr.herokuapp.com/">http://messengr.herokuapp.com/</a>. Have them inspect the source code and explain to the students what HTML code is. Explain that when they are typing a URL into a browser, they are making a GET request to retreive HTML code.</p>

<p>Next, we&rsquo;re going to load the page in our command prompts. In irb, execute the following code.</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">IRB</h1>
          <div class="container"><div class="irb"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1.9.2p320 :001&gt;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>1.9.2p320 :002&gt;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>1.9.2p320 :003&gt;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line command'>require 'httparty'</span><span class='line output'>=&gt; true</span><span class='line command'>response = HTTParty.get("http://messengr.herokuapp.com")</span><span class='line output'>=&gt; #&lt;HTTParty::Response:0x7fd049a38e20 parsed_response="&lt;!DOCTYPE html&gt;...</span><span class='line command'>response.parsed_response</span><span class='line output'>=&gt; "&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;title&gt;Chattr&lt;/title&gt;\n..."</span></code></pre></td></tr></table></div></div>
        </div>


<p>Have them closely inspect the code and look for the text &ldquo;WELCOME TO MESSENGR!&rdquo; to prove that the browser is, in fact, downloading this HTML code.</p>

<h3>Step 1: Hitting an API in the browser</h3>

<p>Next, have them hit the following API endpoint <a href="http://messengr.herokuapp.com/messages.json">http://messengr.herokuapp.com/messages.json</a> in their browsers. If done correctly, they should see a raw JSON string containing the contents of a single message (it won&rsquo;t look as nice):</p>

<p><img class="center" src="/images/projects/messengr/messages_json.png"></p>

<p>Explain to the students what an API does and why it is useful. Tell the students that they&rsquo;ve actually already interacted with an API in the <a href="http://codenoworg.github.io/projects/twitter_bot.html">TwitterBot</a> exercise. Twitter&rsquo;s API allowed us to post messages to our twitter streams as well as send direct messages to our followers.</p>

<h3>Step 2: Hitting an API in the command prompt</h3>

<p>Next, have them hit the same API endpoint in irb. HTTParty makes it easy to send GET requests via the class method <code>.get</code>.</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">IRB</h1>
          <div class="container"><div class="irb"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1.9.2p320 :001&gt;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>1.9.2p320 :002&gt;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>1.9.2p320 :003&gt;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line command'>require 'httparty'</span><span class='line output'>=&gt; true</span><span class='line command'>response = HTTParty.get("http://messengr.herokuapp.com/messages.json")</span><span class='line output'>=&gt; #&lt;HTTParty::Response:0x7fd049a93988 parsed_response=[{"id"=&gt;28, "text"=&gt;"Welcome to Messengr!"...</span><span class='line command'>response.parsed_response</span><span class='line output'>=&gt; [{"id"=&gt;28, "text"=&gt;"Welcome to Messengr!", "room_id"=&gt;nil, "user"=&gt;"edweng", "created_at"=&gt;"2014-01-19T23:01:25.998Z", "updated_at"=&gt;"2014-01-19T23:01:25.998Z"}]</span></code></pre></td></tr></table></div></div>
        </div>


<p>Ask the students what data type the parsed response is returning (spoiler: an array of hashes). Ask the students to list off the keys inside the hash.</p>

<h3>Step 3: Writing the reader script</h3>

<p>Have the students create a file called <code>messengr_reader.rb</code>. Work together to write a method called <code>get_new_messages</code> that will be responsible for sending a GET request to the API endpoint and that returns an array of messages. Once completed, it should look something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;httparty&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">get_new_messages</span>
</span><span class='line'>  <span class="n">response</span> <span class="o">=</span> <span class="no">HTTParty</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://messengr.herokuapp.com/messages.json&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">parsed_response</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="nb">puts</span> <span class="n">get_new_messages</span><span class="o">.</span><span class="n">inspect</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Iteration 2: Sending messages</h2>

<h3>Step 0: Learning about POST requests</h3>

<p>Next, explain to the students that POST requests are used to send information to a server. Give them some examples of POST requests that they will be familiar with (e.g., sending status updates in Facebook, posting Tweets on Twitter, uploading images on Instagram, filling out your shipping address on Amazon, etc.). Make it clear that POST interactions are typically completed in a browser via a &ldquo;submit&rdquo; button, which is different behavior from a GET.</p>

<p>Have the class attempt to post to an endpoint via the command prompt. HTTParty makes it easy to send POST requests via the class method <code>.post</code>.</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">IRB</h1>
          <div class="container"><div class="irb"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1.9.2p320 :001&gt;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>1.9.2p320 :002&gt;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>1.9.2p320 :003&gt;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line command'>require 'httparty'</span><span class='line output'>=&gt; true</span><span class='line command'>response = HTTParty.post("http://messengr.herokuapp.com/")</span><span class='line output'>=&gt; #&lt;HTTParty::Response:0x7fd049cf83b8 parsed_response={"error"=&gt;"Color parameter required.", "status"=&gt;304}, @response=#&lt;Net::HTTPOK 200 OK  readbody=true&gt;, @headers={"x-frame-options"=&gt;["SAMEORIGIN"], "x-xss-protection"=&gt;["1; mode=block"], "x-content-type-options"=&gt;["nosniff"], "x-ua-compatible"=&gt;["chrome=1"], "content-type"=&gt;["application/json; charset=utf-8"], "etag"=&gt;["\"6203cc9bce6069b967018522de122df6\""], "cache-control"=&gt;["max-age=0, private, must-revalidate"], "x-request-id"=&gt;["978ceb14-c626-467a-860d-4bdbeb0e26eb"], "x-runtime"=&gt;["0.018250"], "server"=&gt;["WEBrick/1.3.1 (Ruby/2.0.0/2013-11-22)"], "date"=&gt;["Mon, 20 Jan 2014 00:36:46 GMT"], "content-length"=&gt;["50"], "connection"=&gt;["close"]}&gt;</span><span class='line command'>response.parsed_response</span><span class='line output'>=&gt; {"error"=&gt;"Color parameter can't be blank."}</span></code></pre></td></tr></table></div></div>
        </div>


<p>Ask the students what data type the parsed response is (spoiler: a hash). Ask them what they think the result means and what they&rsquo;ll need to do in order to receive a successful response from the server.</p>

<h3>Step 1: Sending query parameters</h3>

<p>POST requests generally include some kind of information that you want to &ldquo;post&rdquo; or &ldquo;send&rdquo; to the server. The <code>.post</code> method can take a second parameter, a hash, with a key called <code>:query</code>. This <code>:query</code> key points to a value that is a hash of parameters.</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">IRB</h1>
          <div class="container"><div class="irb"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1.9.2p320 :001&gt;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>1.9.2p320 :002&gt;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>1.9.2p320 :003&gt;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line command'>require 'httparty'</span><span class='line output'>=&gt; true</span><span class='line command'>response = HTTParty.post("http://messengr.herokuapp.com/", { :query =&gt; { :color =&gt; "green" } })</span><span class='line output'>=&gt; #&lt;HTTParty::Response:0x7fd04dfb9918 parsed_response={"success"=&gt;"I like green too!"}, @response=#&lt;Net::HTTPOK 200 OK readbody=true&gt;, @headers={"cache-control"=&gt;["max-age=0, private, must-revalidate"], "content-type"=&gt;["application/json; charset=utf-8"], "date"=&gt;["Mon, 20 Jan 2014 00:53:46 GMT"], "etag"=&gt;["\"37fd1df3bb9b0324a5ebcf4c7d1ab154\""], "status"=&gt;["200 OK"], "x-content-type-options"=&gt;["nosniff"], "x-frame-options"=&gt;["SAMEORIGIN"], "x-request-id"=&gt;["c454eea8-c22b-4031-95bb-391d05432cb5"], "x-runtime"=&gt;["0.089777"], "x-ua-compatible"=&gt;["chrome=1"], "x-xss-protection"=&gt;["1; mode=block"], "transfer-encoding"=&gt;["chunked"], "connection"=&gt;["Close"]}&gt;</span><span class='line command'>response.parsed_response</span><span class='line output'>=&gt; {"success"=&gt;"I like green too!"}</span></code></pre></td></tr></table></div></div>
        </div>


<h3>Step 2: Writing the writer script</h3>

<p>Have the students create a file called <code>messengr_writer.rb</code>. Have the students set up their file as follows:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;httparty&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="vi">@user</span> <span class="o">=</span> <span class="s2">&quot;ENTER NAME OF STUDENT HERE&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Work together to write a method called <code>send_message</code> that takes an argument and will be responsible for sending a POST request to the API endpoint. Have the students post to the <a href="http://messengr.herokuapp.com/messages.json">http://messengr.herokuapp.com/messages.json</a> without any parameters. Let them deduce how the query should be structured. Once completed, it should look something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;httparty&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="vi">@user</span> <span class="o">=</span> <span class="s2">&quot;edweng&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span class='line'>  <span class="n">response</span> <span class="o">=</span> <span class="no">HTTParty</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;http://messengr.herokuapp.com/messages.json&quot;</span><span class="p">,</span> <span class="ss">:query</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:user</span> <span class="o">=&gt;</span> <span class="vi">@user</span><span class="p">,</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="n">message</span> <span class="p">})</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">response</span><span class="o">.</span><span class="n">parsed_response</span><span class="o">.</span><span class="n">inspect</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;ERROR: </span><span class="si">#{</span><span class="n">response</span><span class="o">.</span><span class="n">parsed_response</span><span class="o">[</span><span class="s1">&#39;errors&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">parsed_response</span><span class="o">[</span><span class="s2">&quot;errors&quot;</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">send_message</span><span class="p">(</span><span class="s2">&quot;What does the fox say?&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Have the students test out the writer script by running it with <code>ruby messengr_writer.rb</code> in their command prompt windows. Ask the students what they would change in order to make their script better. Explain why we should modify our programs to accept user input from the command line.</p>

<h3>Step 3: Accepting user input</h3>

<p>Students should already be familiar with the <code>gets</code> method from the <a href="http://codenoworg.github.io/projects/hilo.html#iteration-0:-up-&amp;-running">Hi-Lo Game</a>. Do a refresher exercise if needed to demonstrate that the <code>gets</code> command returns a string, why we need to call <code>.chomp</code>, and how we can save the user input into a variable.</p>

<p>Have the students modify their programs to prompt the user to input a message and then send that message to the server. Their scripts should look something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;httparty&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="vi">@user</span> <span class="o">=</span> <span class="s2">&quot;edweng&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span class='line'>  <span class="n">response</span> <span class="o">=</span> <span class="no">HTTParty</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;http://messengr.herokuapp.com/messages.json&quot;</span><span class="p">,</span> <span class="ss">:query</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:user</span> <span class="o">=&gt;</span> <span class="vi">@user</span><span class="p">,</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="n">message</span> <span class="p">})</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">response</span><span class="o">.</span><span class="n">parsed_response</span><span class="o">.</span><span class="n">inspect</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;ERROR: </span><span class="si">#{</span><span class="n">response</span><span class="o">.</span><span class="n">parsed_response</span><span class="o">[</span><span class="s1">&#39;errors&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">parsed_response</span><span class="o">[</span><span class="s2">&quot;errors&quot;</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">message</span> <span class="o">=</span> <span class="nb">gets</span><span class="o">.</span><span class="n">chomp</span>
</span><span class='line'><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ask the students how we can prove that they are successfully sending messages up to the server. Hopefully, someone will suggest we can use our messengr_reader script to verify! Have them execute their reader scripts and verify they can find their messages.</p>

<h2>Iteration 3: Looping it</h2>

<h3>Step 0: Using <code>while</code> loops in messengr_writer</h3>

<p>Our scripts work great, but they could be even better if we didn&rsquo;t have to run the program every time we wanted to send a message. To get around this, we&rsquo;ll want to modify our messengr_writer script to run in a while loop. Start off with a while loop that runs forever. Students should already be familiar with the while loop, but run through an exercise with them to make sure they understand the structure.</p>

<p>The syntax we&rsquo;ve been using throughout the CodeNow course is as follows:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">begin</span>
</span><span class='line'>  <span class="nb">print</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span> <span class="k">while</span> <span class="kp">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>While unconventional, this ensures that all variables in the condition are present and will prevent us from having to initialize variables.</p>

<p>The while loop should look as follows:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;httparty&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="vi">@user</span> <span class="o">=</span> <span class="s2">&quot;edweng&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span class='line'>  <span class="n">response</span> <span class="o">=</span> <span class="no">HTTParty</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;http://messengr.herokuapp.com/messages.json&quot;</span><span class="p">,</span> <span class="ss">:query</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:user</span> <span class="o">=&gt;</span> <span class="vi">@user</span><span class="p">,</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="n">message</span> <span class="p">})</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">response</span><span class="o">.</span><span class="n">parsed_response</span><span class="o">.</span><span class="n">inspect</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;ERROR: </span><span class="si">#{</span><span class="n">response</span><span class="o">.</span><span class="n">parsed_response</span><span class="o">[</span><span class="s1">&#39;errors&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">parsed_response</span><span class="o">[</span><span class="s2">&quot;errors&quot;</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">begin</span>
</span><span class='line'>  <span class="nb">print</span> <span class="s2">&quot;Say something: &quot;</span>
</span><span class='line'>  <span class="n">message</span> <span class="o">=</span> <span class="nb">gets</span><span class="o">.</span><span class="n">chomp</span>
</span><span class='line'>  <span class="n">response</span> <span class="o">=</span> <span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span> <span class="k">while</span> <span class="kp">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>Have students run their messengr_writer scripts and confirm using their messengr_reader scripts that messages are being posted.</p>

<h3>Step 1: Conditioning the <code>while</code> loop</h3>

<p>Next, we want to build in functionality such that if the user types in &lsquo;quit&rsquo;, our writer script stops looping. Have them modify their programs to incorporate this feature.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">begin</span>
</span><span class='line'>  <span class="nb">print</span> <span class="s2">&quot;Say something: &quot;</span>
</span><span class='line'>  <span class="n">message</span> <span class="o">=</span> <span class="nb">gets</span><span class="o">.</span><span class="n">chomp</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">message</span> <span class="o">!=</span> <span class="s2">&quot;quit&quot;</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span> <span class="k">while</span> <span class="n">message</span> <span class="o">!=</span> <span class="s2">&quot;quit&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Step 2: Using <code>while</code> loops in messengr_reader</h3>

<p>We&rsquo;ll also want to use a while loop in our messengr_reader program so that we can continue to receive new messages that appear in the chat room. Have the students add a while loop that repeats indefinitely.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;httparty&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">get_new_messages</span>
</span><span class='line'>  <span class="n">response</span> <span class="o">=</span> <span class="no">HTTParty</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://messengr.herokuapp.com/messages.json&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">parsed_response</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">begin</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">get_new_messages</span><span class="o">.</span><span class="n">inspect</span>
</span><span class='line'><span class="k">end</span> <span class="k">while</span> <span class="kp">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>The problem with the above code is that it will spawn a ton of requests to the server and we&rsquo;ll essentially DDoS ourselves. Explain to the students how DDoS work and have the students add in a <code>sleep</code> call to slow down the amount of GET requests.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;httparty&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">get_new_messages</span>
</span><span class='line'>  <span class="n">response</span> <span class="o">=</span> <span class="no">HTTParty</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://messengr.herokuapp.com/messages.json&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">parsed_response</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">begin</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">get_new_messages</span><span class="o">.</span><span class="n">inspect</span>
</span><span class='line'>  <span class="nb">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span> <span class="k">while</span> <span class="kp">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>The second problem with the code is that it pulls messages that we have already seen. Tell the student that there&rsquo;s a parameter called <code>:last_message_id</code> that the API accepts. Ask them what they think that parameter does. Have them experiment with that parameter in IRB.</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">IRB</h1>
          <div class="container"><div class="irb"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1.9.2p320 :001&gt;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>1.9.2p320 :002&gt;</span>
<span class='line-number'>1.9.2p320 :003&gt;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>1.9.2p320 :004&gt;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line command'>require 'httparty'</span><span class='line output'>=&gt; true</span><span class='line command'>last_message_id = 27 # this id will be different for each class</span><span class='line command'>response = HTTParty.get("http://messengr.herokuapp.com/messages.json", :query =&gt; { :last_message_id =&gt; last_message_id })</span><span class='line output'>=&gt; #&lt;HTTParty::Response:0x7fd049a93988 parsed_response=[{"id"=&gt;28, "text"=&gt;"Welcome to Messengr!"...</span><span class='line command'>response.parsed_response</span><span class='line output'>=&gt; [{"id"=&gt;28, "text"=&gt;"Welcome to Messengr!", "room_id"=&gt;nil, "user"=&gt;"edweng", "created_at"=&gt;"2014-01-19T23:01:25.998Z", "updated_at"=&gt;"2014-01-19T23:01:25.998Z"}]</span></code></pre></td></tr></table></div></div>
        </div>


<p>We&rsquo;re going to have to modify our <code>get_new_messages</code> method to accept an argument <code>last_message_id</code>. If they get stuck, have students refer to their implementation of send_message to figure out how they change the method&rsquo;s signature to accept an argument.</p>

<p>When finished, the <code>get_new_messages</code> method should look something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">get_new_messages</span><span class="p">(</span><span class="n">last_message_id</span><span class="p">)</span>
</span><span class='line'>  <span class="n">response</span> <span class="o">=</span> <span class="no">HTTParty</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://messengr.herokuapp.com/messages.json&quot;</span><span class="p">,</span> <span class="ss">:query</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:last_message_id</span> <span class="o">=&gt;</span> <span class="n">last_message_id</span> <span class="p">})</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">parsed_response</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, the while loop has to be modified to call our new <code>get_new_messages</code> method. Have the students work on modifying their method in messengr_reader such that the last_message_id variable is set in their <code>while</code> loops. Run through a refresher with students on how you can access the <code>id</code> key inside their message hash. Once modified, the <code>while</code> loop of the code should appear as follows:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">last_message_id</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'><span class="k">begin</span>
</span><span class='line'>  <span class="n">messages</span> <span class="o">=</span> <span class="n">get_new_messages</span><span class="p">(</span><span class="n">last_message_id</span><span class="p">)</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">messages</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span class='line'>    <span class="n">last_message_id</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">last</span><span class="o">[</span><span class="s2">&quot;id&quot;</span><span class="o">]</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="n">messages</span><span class="o">.</span><span class="n">inspect</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="nb">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span> <span class="k">while</span> <span class="kp">true</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Step 3: Testing everything out</h3>

<p>Have students open up a second command prompt window. Have one window be their writing client and have the other window be their reading client. Have them send messages between themselves and make sure that their functionality is working.</p>

<p><img class="center" src="/images/projects/messengr/chat_setup.png"></p>

<h2>Iteration 4: Prettifying the message format</h2>

<p>So far, we&rsquo;ve just been printing out the inspected version of the API response. What we&rsquo;re receiving back is an array of message hashes. It would be cool if we could make our messages a little bit prettier. Ask the students which portion of their code we will need to modify in order to make reading messages easier.</p>

<h3>Step 0: Nested loops: Looping through each of the messages</h3>

<p>In order to make things look nice, we&rsquo;ll have to work with individual messages. This will require us to use the <code>each</code> loop. In the past, students have struggled with grasping the concept of an <code>each</code> loop, so make sure you give them plenty of assistance with setting it up and explaining how it works.</p>

<p>The while loop in the <code>messengr_reader</code> script should look as follows:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">last_message_id</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'><span class="k">begin</span>
</span><span class='line'>  <span class="n">messages</span> <span class="o">=</span> <span class="n">get_new_messages</span><span class="p">(</span><span class="n">last_message_id</span><span class="p">)</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">messages</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span class='line'>    <span class="n">last_message_id</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">last</span><span class="o">[</span><span class="s2">&quot;id&quot;</span><span class="o">]</span>
</span><span class='line'>    <span class="n">messages</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">message</span><span class="o">|</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="n">message</span><span class="o">.</span><span class="n">inspect</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="nb">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span> <span class="k">while</span> <span class="kp">true</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Step 1: Printing out the basics</h3>

<p>We want to start off simply by printing out the user key and the text key. Students should be familiar with string interpolation and should be able to come up with something that looks as follows:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">last_message_id</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'><span class="k">begin</span>
</span><span class='line'>  <span class="n">messages</span> <span class="o">=</span> <span class="n">get_new_messages</span><span class="p">(</span><span class="n">last_message_id</span><span class="p">)</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">messages</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span class='line'>    <span class="n">last_message_id</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">last</span><span class="o">[</span><span class="s2">&quot;id&quot;</span><span class="o">]</span>
</span><span class='line'>    <span class="n">messages</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">message</span><span class="o">|</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">message</span><span class="o">[</span><span class="s1">&#39;user&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">message</span><span class="o">[</span><span class="s1">&#39;text&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="nb">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span> <span class="k">while</span> <span class="kp">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>Students should see their formatted messages look as follows:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">IRB</h1>
          <div class="container"><div class="irb"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line output'>ruby messengr_reader.rb</span><span class='line output'>edweng: Welcome to Messengr!</span><span class='line output'>edweng: Hello, world!</span></code></pre></td></tr></table></div></div>
        </div>


<h3>Step 2: Formatting a time</h3>

<p>One feature that might be nice to have message timestamps so that we can determine when a message was last sent.</p>

<p>If we want to format a time to be a human readable string, Ruby provides us with convenience methods to do that. In IRB, using the <a href="http://apidock.com/ruby/DateTime/strftime">Ruby docs</a> try out a few different ways to format a Time object.</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">IRB</h1>
          <div class="container"><div class="irb"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1.9.2p320 :001&gt;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>1.9.2p320 :002&gt;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>1.9.2p320 :003&gt;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>1.9.2p320 :004&gt;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line command'>Time.now</span><span class='line output'>=&gt; 2014-02-02 19:29:11 UTC</span><span class='line command'>Time.now.getlocal</span><span class='line output'>=&gt; 2014-02-02 15:18:10 -0500</span><span class='line command'>Time.now.getlocal.strftime("%m/%d/%Y")</span><span class='line output'>=&gt; "2/2/2014"</span><span class='line command'>Time.now.getlocal.strftime("%H:%M")</span><span class='line output'>=&gt; "15:18"</span></code></pre></td></tr></table></div></div>
        </div>


<p>When we get the message object back from the API, we&rsquo;re dealing with a string, not a Time object. Show the students the difference between a Time object and a Time string. Then explain to them that in order to use the <code>strftime</code> method, we&rsquo;ll need to first parse the time out and then format it.</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">IRB</h1>
          <div class="container"><div class="irb"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1.9.2p320 :001&gt;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>1.9.2p320 :002&gt;</span>
<span class='line-number'>1.9.2p320 :003&gt;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>1.9.2p320 :004&gt;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>1.9.2p320 :005&gt;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>1.9.2p320 :006&gt;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>1.9.2p320 :007&gt;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>1.9.2p320 :008&gt;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line command'>require 'httparty'</span><span class='line output'>=&gt; true</span><span class='line command'>last_message_id = 27 # this id will be different for each class</span><span class='line command'>response = HTTParty.get("http://messengr.herokuapp.com/messages.json", :query =&gt; { :last_message_id =&gt; last_message_id })</span><span class='line output'>=&gt; #&lt;HTTParty::Response:0x7fd049a93988 parsed_response=[{"id"=&gt;28, "text"=&gt;"Welcome to Messengr!"...</span><span class='line command'>messages = response.parsed_response</span><span class='line output'>=&gt; [{"id"=&gt;28, "text"=&gt;"Welcome to Messengr!", "room_id"=&gt;nil, "user"=&gt;"edweng", "created_at"=&gt;"2014-01-19T23:01:25.998Z", "updated_at"=&gt;"2014-01-19T23:01:25.998Z"}]</span><span class='line command'>message = messages.first</span><span class='line output'>=&gt; {"id"=&gt;28, "text"=&gt;"Welcome to Messengr!", "room_id"=&gt;nil, "user"=&gt;"edweng", "created_at"=&gt;"2014-01-19T23:01:25.998Z", "updated_at"=&gt;"2014-01-19T23:01:25.998Z"}</span><span class='line command'>message["created_at"]</span><span class='line output'>=&gt; "2014-01-19T23:01:25.998Z"</span><span class='line command'>Time.parse(message["created_at"])</span><span class='line output'>=&gt; 2014-02-02 19:29:11 UTC</span><span class='line command'>Time.parse(message["created_at"]).getlocal.strftime("%H:%M")</span><span class='line output'>=&gt; "14:29"</span></code></pre></td></tr></table></div></div>
        </div>


<p>Have the students incorporate this into their puts statment.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">last_message_id</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'><span class="k">begin</span>
</span><span class='line'>  <span class="n">messages</span> <span class="o">=</span> <span class="n">get_new_messages</span><span class="p">(</span><span class="n">last_message_id</span><span class="p">)</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">messages</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span class='line'>    <span class="n">last_message_id</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">last</span><span class="o">[</span><span class="s2">&quot;id&quot;</span><span class="o">]</span>
</span><span class='line'>    <span class="n">messages</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">message</span><span class="o">|</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Time</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">message</span><span class="o">[</span><span class="s1">&#39;created_at&#39;</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">getlocal</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H:%M&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">message</span><span class="o">[</span><span class="s1">&#39;user&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">message</span><span class="o">[</span><span class="s1">&#39;text&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="nb">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span> <span class="k">while</span> <span class="kp">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>Students should see their formatted messages look as follows:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">IRB</h1>
          <div class="container"><div class="irb"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
</pre></td><td class='code'><pre><code><span class='line output'>ruby messengr_reader.rb</span><span class='line output'>14:29 edweng: Welcome to Messengr!</span><span class='line output'>15:03 edweng: Hello, world!</span></code></pre></td></tr></table></div></div>
        </div>


<h2>Extensions</h2>

<p>Here are a list of extensions that students can build if they finish early:
&ndash; Refactor the puts statement in <code>messengr_reader.rb</code> into its own <code>print_message(message)</code> method
&ndash; Have the <code>messengr_writer</code> announce when a user connects and disconnects from a room
&ndash; Experiment with the room parameter in the API</p>

    
      <footer>
        
        
          <div class="sharing">
  
  
  
</div>

        
      </footer>
    
  </article>


</div>


  <span class="toggle-sidebar"></span>

<aside class="sidebar">
  <div> </div>
</aside>

<script src="/javascripts/sidebar.js" type="text/javascript"> </script>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - CodeNowOrg -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

<script>
  //Super secure password protection version 42.93438
  //Ryan wanted a password protection so that students can't just go on the
  //curriculum page and read the answers. Unfortunately we're hosting things
  //on github right now, so we can't do any form of real password protection :(
  //But basic Javascript is enough for now.
  //
  //If you are a student and you figure this out...rock on!
  if (! document.cookie){
     window.document.body.style.display = 'none';
     var password = prompt("Password?");
  }

  if ( btoa(password) == 'YzBkZW4wdyExMjQ=' ){
     window.document.body.style.display = 'block';
     document.cookie = 'authed=true; expires=31 Dec 2020 00:00:00 GMT';
  }
</script>

</footer>
  











</body>
</html>
